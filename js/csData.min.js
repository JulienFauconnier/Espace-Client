$(document).ready(function(){function t(){$("#docList").empty(),$.post("inc/getDList.php",function(t){var i=jQuery.parseJSON(t);$.each(i,function(){$("#docList").append('<tr><td class="date">'+this.created+'</td><td class="description">'+this.subject+'</td><td class="price">'+Math.round(100*this.totalAmount)/100+'€ TTC</td><td class="cta-button"><button class="alert tiny radius ddl" id="'+this.id+'" type="button"><strong>⇩</strong></button></td></tr>')})})}function i(t,i){1==t&&(o=$("#choix_type option:selected").attr("id"),a.html(""),a.append('<option id="none">Choisir une Catégorie</option>'),e=$("#choix_cat option:selected").attr("id")),1==i&&(e=$("#choix_cat option:selected").attr("id"),p.html(""),p.append('<option id="none">Choisir une Prestation</option>'),c=$("#choix_id option:selected").attr("id")),$("#addb").prop("disabled",!0)}function n(){$("#result").empty(),d=0,""!=r?$.each(r,function(){$("#result").append('<tr><td class="title">'+this.row_name+'</td><td class="description">'+this.row_notes+'</td><td class="quantity">'+this.row_qt+'</td><td class="price">'+Math.round(100*this.row_unitAmount)/100+'€</td><td class="price">'+Math.round(100*this.row_purchaseAmount)/100+'€</td><td class="cta-button"><button class="alert tiny radius rmv" id="'+d+'" type="button"><strong>X</strong></button></td></tr>'),d++}):($("#submit").prop("disabled",!0),$("#reset").prop("disabled",!0))}var o,e,c,d,s=$("#choix_qt").val(),a=$("#choix_cat"),p=$("#choix_id"),r=[];$(document).on("click",".ddl",function(){$.post("inc/getDLink.php",{docid:this.id},function(t){window.location.href="https://sellsy.com/"+t})}),t(),$(document).on("click",".rmv",function(){r.splice(this.id,1),n()}),i("1","1"),n(),$("#choix_type").change(function(){i(1,1),"none"!=o&&$.post("inc/getSTList.php",function(t){var i=jQuery.parseJSON(t);$.each(i,function(){a.append('<option id="'+this.word+'">'+this.word.substring(0,this.word.length-2)+"</option>")})})}),$("#choix_cat").change(function(){i(0,1),"none"!=o&&"none"!=e&&$.post("inc/getCList.php",{type:o,cat:e},function(t){var i=jQuery.parseJSON(t);$.each(i,function(){p.append('<option id="'+this.id+'">'+this.tradename+" - "+Math.round(100*this.unitAmount)/100+" € HT</option>")})})}),$("#choix_id").change(function(){c=$("#choix_id option:selected").attr("id"),"none"!=c?$("#addb").prop("disabled",!1):$("#addb").prop("disabled",!0)}),$("#choix_qt").change(function(){s=$(this).val()}),$("#addb").click(function(){$.post("inc/getCOne.php",{id:c,type:o,qt:s},function(t){r.push(jQuery.parseJSON(t)),n(),$("#submit").prop("disabled",!1),$("#reset").prop("disabled",!1)})}),$("#submit").click(function(){""!=r&&$.post("inc/createEDoc.php",{row:r},function(){r=[],n(),t()})}),$("#reset").click(function(){r=[],n()})});